<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î—É—Ä–∞–∫ - Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=PT+Mono:wght@400&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'PT Mono', 'Courier New', monospace;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            text-align: center;
        }

        h1 {
            color: var(--tg-theme-button-color, #0088cc);
            margin-bottom: 20px;
            font-size: 28px;
        }

        .user-info {
            background: var(--tg-theme-secondary-bg-color, #f1f1f1);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 20px;
            color: white;
            margin: 20px 0;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }

        .button {
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, white);
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            font-family: 'PT Mono', monospace;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .button:hover {
            opacity: 0.8;
            transform: translateY(-2px);
        }

        .game-preview {
            background: linear-gradient(45deg, #2196F3, #21CBF3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            color: white;
        }

        .cards-demo {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }

        .opponent-cards {
            display: flex;
            justify-content: center;
            margin: 15px 0;
        }

        .opponent-cards .demo-card {
            margin-left: -25px; /* –ö–∞—Ä—Ç—ã –Ω–∞–µ–∑–∂–∞—é—Ç –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞ */
        }

        .opponent-cards .demo-card:first-child {
            margin-left: 0; /* –ü–µ—Ä–≤–∞—è –∫–∞—Ä—Ç–∞ –±–µ–∑ –æ—Ç—Å—Ç—É–ø–∞ */
        }

        .demo-card {
            width: 50px;
            height: 70px;
            background: white;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #333;
            font-size: 18px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .demo-card.back {
            background: linear-gradient(135deg, #1a237e, #3949ab);
            color: white;
        }

        .demo-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .demo-card.selected {
            border: 3px solid #2196F3;
            transform: translateY(-10px);
        }

        .demo-card.red {
            color: #d32f2f;
        }

        .cards-container {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 10px 0;
            min-height: 80px;
            align-items: center;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .table-cards, .opponent-hand, .player-hand {
            margin: 15px 0;
        }

        .table-cards h4, .opponent-hand h4, .player-hand h4 {
            margin-bottom: 10px;
            color: rgba(255,255,255,0.9);
        }

        .game-actions {
            margin-top: 15px;
        }

        .trump-indicator {
            position: absolute;
            top: -5px;
            right: -5px;
            background: gold;
            color: black;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .demo-card:nth-child(1) { } 
        .demo-card:nth-child(2) { } 
        .demo-card:nth-child(3) { }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .status {
            font-size: 14px;
            opacity: 0.7;
            margin-top: 15px;
        }

        .coming-soon {
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üÉè –î—É—Ä–∞–∫</h1>
        
        <div class="card">
            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
            <p>Telegram Mini App —Ä–∞–±–æ—Ç–∞–µ—Ç!</p>
        </div>

        <div class="user-info" id="userInfo">
            <h3>üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h3>
            <p id="userName">–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</p>
            <p id="userLang">–Ø–∑—ã–∫: –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</p>
        </div>

        <div class="game-preview">
            <h3>üéÆ –ò–≥—Ä–∞ "–î—É—Ä–∞–∫"</h3>
            <div id="gameArea" style="display: none;">
                <div class="game-info">
                    <div>–ö–æ–∑—ã—Ä—å: <span id="trumpSuit">‚ô†</span></div>
                    <div>–ö–∞—Ä—Ç –≤ –∫–æ–ª–æ–¥–µ: <span id="deckCount">36</span></div>
                    <div>–•–æ–¥: <span id="currentPlayer">–í–∞—à</span></div>
                </div>
                
                <div class="table-cards">
                    <h4>–ù–∞ —Å—Ç–æ–ª–µ:</h4>
                    <div id="tableCards" class="cards-container">
                        <!-- –ö–∞—Ä—Ç—ã –Ω–∞ —Å—Ç–æ–ª–µ -->
                    </div>
                </div>
                
                <div class="opponent-hand">
                    <h4>–ö–∞—Ä—Ç—ã –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞: <span id="opponentCardCount">6</span></h4>
                    <div id="opponentCards" class="opponent-cards">
                        <!-- –ö–∞—Ä—Ç—ã –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
                
                <div class="player-hand">
                    <h4>–í–∞—à–∏ –∫–∞—Ä—Ç—ã:</h4>
                    <div id="playerCards" class="cards-container">
                        <!-- –ö–∞—Ä—Ç—ã –∏–≥—Ä–æ–∫–∞ -->
                    </div>
                </div>
                
                <div class="game-actions">
                    <button class="button" onclick="takeCards()" id="takeBtn" style="display:none;">–í–∑—è—Ç—å –∫–∞—Ä—Ç—ã</button>
                    <button class="button" onclick="passTurn()" id="passBtn" style="display:none;">–ë–∏—Ç–æ</button>
                </div>
            </div>
            
            <div id="gameMenu">
                <div class="cards-demo">
                    <div class="demo-card">‚ô†Ô∏è</div>
                    <div class="demo-card">‚ô•Ô∏è</div>
                    <div class="demo-card">‚ô£Ô∏è</div>
                </div>
                <p>–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–æ—á–Ω–∞—è –∏–≥—Ä–∞ "–î—É—Ä–∞–∫"</p>
                <button class="button" onclick="startGame()">üéÆ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            </div>
        </div>

        <div class="coming-soon">
            <p>üöß –ò–≥—Ä–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
            <p>–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –∏–≥—Ä–∞ –≤ –¥—É—Ä–∞–∫–∞!</p>
        </div>

        <div class="status" id="status">
            –°—Ç–∞—Ç—É—Å: Mini App –∑–∞–≥—Ä—É–∂–µ–Ω
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        tg.ready();
        tg.expand();
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
        tg.MainButton.text = "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É";
        tg.MainButton.color = "#2196F3";
        tg.MainButton.show();
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
        tg.MainButton.onClick(function() {
            tg.showAlert("–ò–≥—Ä–∞ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–∞! üéÆ");
        });

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        function initUser() {
            const user = tg.initDataUnsafe?.user;
            
            if (user) {
                document.getElementById('userName').innerHTML = 
                    `–ü—Ä–∏–≤–µ—Ç, ${user.first_name || '–ò–≥—Ä–æ–∫'}! üëã`;
                document.getElementById('userLang').innerHTML = 
                    `–Ø–∑—ã–∫: ${user.language_code || '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}`;
            } else {
                document.getElementById('userName').innerHTML = 
                    '–ü—Ä–∏–≤–µ—Ç, –ò–≥—Ä–æ–∫! üëã';
                document.getElementById('userLang').innerHTML = 
                    '–†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–≤–Ω–µ Telegram)';
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        function sendMessage() {
            const message = "–ü—Ä–∏–≤–µ—Ç –∏–∑ Mini App! üéÆ –ì–æ—Ç–æ–≤ –∏–≥—Ä–∞—Ç—å –≤ –¥—É—Ä–∞–∫–∞!";
            tg.sendData(message);
        }

        function showAlert() {
            tg.showAlert("–≠—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç Mini App! üîî");
        }

        function vibrate() {
            if (tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('medium');
                updateStatus("–í–∏–±—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞! üì≥");
            } else {
                updateStatus("–í–∏–±—Ä–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");
            }
        }

        function updateStatus(message) {
            document.getElementById('status').textContent = `–°—Ç–∞—Ç—É—Å: ${message}`;
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π Telegram
        tg.onEvent('mainButtonClicked', function() {
            console.log('Main button clicked');
        });

        tg.onEvent('viewportChanged', function() {
            updateStatus('–†–∞–∑–º–µ—Ä –æ–∫–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω');
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            initUser();
            updateStatus('Mini App –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ! ‚úÖ');
            
            // –ï—Å–ª–∏ –Ω–µ –≤ Telegram - –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É
            if (!tg.initData) {
                updateStatus('‚ö†Ô∏è –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram –¥–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏');
            }
        });

        // === –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ===
        
        // –ò–≥—Ä–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        let gameState = {
            deck: [],
            playerHand: [],
            opponentHand: [],
            tableCards: [],
            trumpSuit: '',
            currentPlayer: 'player', // 'player' –∏–ª–∏ 'opponent'
            gamePhase: 'attack', // 'attack' –∏–ª–∏ 'defend'
            attacker: 'player'
        };

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–æ–¥—ã
        function createDeck() {
            const suits = ['‚ô†', '‚ô£', '‚ô¶', '‚ô•'];
            const values = ['6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
            const deck = [];
            
            for (let suit of suits) {
                for (let value of values) {
                    deck.push({
                        suit: suit,
                        value: value,
                        isRed: suit === '‚ô¶' || suit === '‚ô•',
                        weight: values.indexOf(value)
                    });
                }
            }
            
            // –ü–µ—Ä–µ–º–µ—à–∞—Ç—å –∫–æ–ª–æ–¥—É
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            
            return deck;
        }

        // –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
        function startGame() {
            // –°–æ–∑–¥–∞—Ç—å –∫–æ–ª–æ–¥—É –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–∑—ã—Ä—å
            gameState.deck = createDeck();
            const trumpCard = gameState.deck[0];
            gameState.trumpSuit = trumpCard.suit;
            
            // –†–∞–∑–¥–∞—Ç—å –∫–∞—Ä—Ç—ã
            gameState.playerHand = gameState.deck.splice(0, 6);
            gameState.opponentHand = gameState.deck.splice(0, 6);
            
            // –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫—Ç–æ —Ö–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–º (—É –∫–æ–≥–æ –º–ª–∞–¥—à–∏–π –∫–æ–∑—ã—Ä—å)
            const playerTrumps = gameState.playerHand.filter(card => card.suit === gameState.trumpSuit);
            const opponentTrumps = gameState.opponentHand.filter(card => card.suit === gameState.trumpSuit);
            
            let minPlayerTrump = playerTrumps.length > 0 ? Math.min(...playerTrumps.map(c => c.weight)) : 999;
            let minOpponentTrump = opponentTrumps.length > 0 ? Math.min(...opponentTrumps.map(c => c.weight)) : 999;
            
            if (minPlayerTrump < minOpponentTrump) {
                gameState.currentPlayer = 'player';
                gameState.attacker = 'player';
            } else {
                gameState.currentPlayer = 'opponent';
                gameState.attacker = 'opponent';
                setTimeout(opponentMove, 1000);
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ
            document.getElementById('gameMenu').style.display = 'none';
            document.getElementById('gameArea').style.display = 'block';
            
            updateGameDisplay();
            updateStatus('–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! üéÆ');
            
            // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            tg.MainButton.text = "–ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É";
            tg.MainButton.onClick = function() {
                endGame();
            };
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–≥—Ä—ã
        function updateGameDisplay() {
            // –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            document.getElementById('trumpSuit').textContent = gameState.trumpSuit;
            document.getElementById('deckCount').textContent = gameState.deck.length;
            document.getElementById('currentPlayer').textContent = 
                gameState.currentPlayer === 'player' ? '–í–∞—à' : '–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞';
            document.getElementById('opponentCardCount').textContent = gameState.opponentHand.length;
            
            // –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∫–∞—Ä—Ç—ã –∏–≥—Ä–æ–∫–∞
            const playerCardsEl = document.getElementById('playerCards');
            playerCardsEl.innerHTML = '';
            
            const sortedHand = sortPlayerHand(gameState.playerHand);
            sortedHand.forEach((card, index) => {
                const originalIndex = gameState.playerHand.indexOf(card);
                const cardEl = createCardElement(card, originalIndex);
                playerCardsEl.appendChild(cardEl);
            });
            
            // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∫–∞—Ä—Ç—ã –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ (—Ä—É–±–∞—à–∫–∏)
            const opponentCardsEl = document.getElementById('opponentCards');
            opponentCardsEl.innerHTML = '';
            
            for (let i = 0; i < gameState.opponentHand.length; i++) {
                const cardEl = document.createElement('div');
                cardEl.className = 'demo-card back';
                cardEl.textContent = 'üÇ†';
                opponentCardsEl.appendChild(cardEl);
            }
            
            // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∫–∞—Ä—Ç—ã –Ω–∞ —Å—Ç–æ–ª–µ
            const tableCardsEl = document.getElementById('tableCards');
            tableCardsEl.innerHTML = '';
            
            if (gameState.tableCards.length === 0) {
                tableCardsEl.innerHTML = '<div style="color: rgba(255,255,255,0.5); font-style: italic;">–°—Ç–æ–ª –ø—É—Å—Ç</div>';
            } else {
                gameState.tableCards.forEach((pair, index) => {
                    const pairEl = document.createElement('div');
                    pairEl.style.display = 'flex';
                    pairEl.style.gap = '5px';
                    pairEl.style.margin = '5px';
                    
                    const attackCard = createCardElement(pair.attack);
                    pairEl.appendChild(attackCard);
                    
                    if (pair.defend) {
                        const defendCard = createCardElement(pair.defend);
                        defendCard.style.marginLeft = '-30px';
                        defendCard.style.transform = 'rotate(15deg)';
                        pairEl.appendChild(defendCard);
                    }
                    
                    tableCardsEl.appendChild(pairEl);
                });
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
            updateActionButtons();
        }

        // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∫–∞—Ä—Ç –∏–≥—Ä–æ–∫–∞
        function sortPlayerHand(hand) {
            // –ü–æ—Ä—è–¥–æ–∫ –º–∞—Å—Ç–µ–π (–Ω–µ–∫–æ–∑—ã—Ä–Ω—ã–µ)
            const suitOrder = ['‚ô†', '‚ô£', '‚ô¶', '‚ô•'];
            
            // –†–∞–∑–¥–µ–ª—è–µ–º –∫–æ–∑—ã—Ä–∏ –∏ –Ω–µ–∫–æ–∑—ã—Ä–∏
            const trumpCards = hand.filter(card => card.suit === gameState.trumpSuit);
            const nonTrumpCards = hand.filter(card => card.suit !== gameState.trumpSuit);
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–µ–∫–æ–∑—ã—Ä–Ω—ã–µ –∫–∞—Ä—Ç—ã –ø–æ –º–∞—Å—Ç—è–º, –∑–∞—Ç–µ–º –ø–æ —Ä–∞–Ω–≥—É
            nonTrumpCards.sort((a, b) => {
                const suitDiff = suitOrder.indexOf(a.suit) - suitOrder.indexOf(b.suit);
                if (suitDiff !== 0) return suitDiff;
                return a.weight - b.weight; // –û—Ç –º–ª–∞–¥—à–µ–π –∫ —Å—Ç–∞—Ä—à–µ–π
            });
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–∑—ã—Ä–∏ –ø–æ —Ä–∞–Ω–≥—É (–æ—Ç –º–ª–∞–¥—à–µ–≥–æ –∫ —Å—Ç–∞—Ä—à–µ–º—É)
            trumpCards.sort((a, b) => a.weight - b.weight);
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º: —Å–Ω–∞—á–∞–ª–∞ –Ω–µ–∫–æ–∑—ã—Ä–∏, –ø–æ—Ç–æ–º –∫–æ–∑—ã—Ä–∏ (–∫–æ–∑—ã—Ä–∏ —Å–ø—Ä–∞–≤–∞)
            return [...nonTrumpCards, ...trumpCards];
        }

        // –°–æ–∑–¥–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç –∫–∞—Ä—Ç—ã
        function createCardElement(card, index = -1) {
            const cardEl = document.createElement('div');
            cardEl.className = `demo-card ${card.isRed ? 'red' : ''}`;
            cardEl.textContent = card.value + card.suit;
            
            // –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∫–æ–∑—ã—Ä—è
            if (card.suit === gameState.trumpSuit) {
                const trumpEl = document.createElement('div');
                trumpEl.className = 'trump-indicator';
                trumpEl.textContent = '‚òÖ';
                cardEl.appendChild(trumpEl);
            }
            
            // –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –∫–∞—Ä—Ç –∏–≥—Ä–æ–∫–∞
            if (index !== -1) {
                cardEl.onclick = () => playCard(index);
                cardEl.style.cursor = 'pointer';
            }
            
            return cardEl;
        }

        // –°—ã–≥—Ä–∞—Ç—å –∫–∞—Ä—Ç—É
        function playCard(cardIndex) {
            if (gameState.currentPlayer !== 'player') {
                updateStatus('–ù–µ –≤–∞—à —Ö–æ–¥!');
                return;
            }
            
            const card = gameState.playerHand[cardIndex];
            
            if (gameState.attacker === 'player') {
                // –ò–≥—Ä–æ–∫ –∞—Ç–∞–∫—É–µ—Ç
                if (canAttack(card)) {
                    gameState.tableCards.push({ attack: card, defend: null });
                    gameState.playerHand.splice(cardIndex, 1);
                    gameState.currentPlayer = 'opponent';
                    gameState.gamePhase = 'defend';
                    
                    updateGameDisplay();
                    updateStatus('–í—ã –∞—Ç–∞–∫–æ–≤–∞–ª–∏ –∫–∞—Ä—Ç–æ–π ' + card.value + card.suit);
                    
                    // –•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
                    setTimeout(opponentMove, 1000);
                } else {
                    updateStatus('–ù–µ–ª—å–∑—è –∞—Ç–∞–∫–æ–≤–∞—Ç—å —ç—Ç–æ–π –∫–∞—Ä—Ç–æ–π!');
                }
            } else {
                // –ò–≥—Ä–æ–∫ –∑–∞—â–∏—â–∞–µ—Ç—Å—è
                const undefendedPair = gameState.tableCards.find(pair => !pair.defend);
                if (undefendedPair && canDefend(card, undefendedPair.attack)) {
                    undefendedPair.defend = card;
                    gameState.playerHand.splice(cardIndex, 1);
                    
                    updateGameDisplay();
                    updateStatus('–í—ã –æ—Ç–±–∏–ª–∏—Å—å –∫–∞—Ä—Ç–æ–π ' + card.value + card.suit);
                    
                    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤—Å–µ –ª–∏ –∫–∞—Ä—Ç—ã –æ—Ç–±–∏—Ç—ã
                    if (gameState.tableCards.every(pair => pair.defend)) {
                        // –í—Å–µ –∫–∞—Ä—Ç—ã –æ—Ç–±–∏—Ç—ã - –ø–µ—Ä–µ–¥–∞–µ–º —Ö–æ–¥ –∞—Ç–∞–∫—É—é—â–µ–º—É –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –ø–æ–¥–∫–∏–¥—ã–≤–∞–Ω–∏—è
                        gameState.currentPlayer = 'opponent';
                        gameState.attacker = 'opponent'; // –¢–µ–ø–µ—Ä—å –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫ –º–æ–∂–µ—Ç –ø–æ–¥–∫–∏–¥—ã–≤–∞—Ç—å
                        setTimeout(opponentMove, 1000);
                    }
                } else {
                    updateStatus('–ù–µ–ª—å–∑—è –æ—Ç–±–∏—Ç—å—Å—è —ç—Ç–æ–π –∫–∞—Ä—Ç–æ–π!');
                }
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –º–æ–∂–Ω–æ –ª–∏ –∞—Ç–∞–∫–æ–≤–∞—Ç—å –∫–∞—Ä—Ç–æ–π
        function canAttack(card) {
            if (gameState.tableCards.length === 0) return true;
            
            // –ú–æ–∂–Ω–æ –ø–æ–¥–∫–∏–¥—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–∞—Ä—Ç—ã —Ç–µ—Ö –∂–µ —Ä–∞–Ω–≥–æ–≤, —á—Ç–æ —É–∂–µ –µ—Å—Ç—å –Ω–∞ —Å—Ç–æ–ª–µ
            const tableValues = [];
            gameState.tableCards.forEach(pair => {
                tableValues.push(pair.attack.value);
                if (pair.defend) tableValues.push(pair.defend.value);
            });
            
            return tableValues.includes(card.value);
        }

        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –º–æ–∂–Ω–æ –ª–∏ –∑–∞—â–∏—Ç–∏—Ç—å—Å—è –∫–∞—Ä—Ç–æ–π
        function canDefend(defendCard, attackCard) {
            // –ö–æ–∑—ã—Ä—å –±—å–µ—Ç –Ω–µ–∫–æ–∑—ã—Ä–Ω—É—é –∫–∞—Ä—Ç—É
            if (defendCard.suit === gameState.trumpSuit && attackCard.suit !== gameState.trumpSuit) {
                return true;
            }
            
            // –ö–∞—Ä—Ç–∞ —Ç–æ–π –∂–µ –º–∞—Å—Ç–∏ –∏ –±–æ–ª—å—à–µ –ø–æ –≤–µ—Å—É
            if (defendCard.suit === attackCard.suit && defendCard.weight > attackCard.weight) {
                return true;
            }
            
            return false;
        }

        // –•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ (–ø—Ä–æ—Å—Ç–æ–π –ò–ò)
        function opponentMove() {
            if (gameState.currentPlayer !== 'opponent') return;
            
            if (gameState.attacker === 'opponent') {
                // –ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –∞—Ç–∞–∫—É–µ—Ç (–ø–µ—Ä–≤–∞—è –∫–∞—Ä—Ç–∞ –∏–ª–∏ –ø–æ–¥–∫–∏–¥—ã–≤–∞–Ω–∏–µ)
                const possibleCards = gameState.opponentHand.filter(card => canAttack(card));
                
                if (possibleCards.length > 0 && gameState.tableCards.length < Math.min(6, gameState.playerHand.length)) {
                    // –†–µ—à–∞–µ–º, –ø–æ–¥–∫–∏–¥—ã–≤–∞—Ç—å –ª–∏ –µ—â–µ (–µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø–µ—Ä–≤–∞—è –∫–∞—Ä—Ç–∞)
                    const shouldContinue = gameState.tableCards.length === 0 || Math.random() > 0.4; // 60% —à–∞–Ω—Å –ø–æ–¥–∫–∏–Ω—É—Ç—å
                    
                    if (shouldContinue) {
                        const card = possibleCards[Math.floor(Math.random() * possibleCards.length)];
                        const cardIndex = gameState.opponentHand.indexOf(card);
                        
                        gameState.tableCards.push({ attack: card, defend: null });
                        gameState.opponentHand.splice(cardIndex, 1);
                        gameState.currentPlayer = 'player';
                        gameState.gamePhase = 'defend';
                        
                        updateGameDisplay();
                        updateStatus('–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –∞—Ç–∞–∫—É–µ—Ç –∫–∞—Ä—Ç–æ–π ' + card.value + card.suit);
                        return;
                    }
                }
                
                // –ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –Ω–µ –∞—Ç–∞–∫—É–µ—Ç/–Ω–µ –ø–æ–¥–∫–∏–¥—ã–≤–∞–µ—Ç - –∑–∞–≤–µ—Ä—à–∞–µ–º —Ä–æ–∑—ã–≥—Ä—ã—à –µ—Å–ª–∏ –≤—Å–µ –æ—Ç–±–∏—Ç—ã
                if (gameState.tableCards.length > 0 && gameState.tableCards.every(pair => pair.defend)) {
                    completeRound();
                } else if (gameState.tableCards.length === 0) {
                    // –ü–µ—Ä–≤–∞—è –∞—Ç–∞–∫–∞ - –¥–æ–ª–∂–µ–Ω –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å—Ö–æ–¥–∏—Ç—å
                    const anyCard = gameState.opponentHand[Math.floor(Math.random() * gameState.opponentHand.length)];
                    const cardIndex = gameState.opponentHand.indexOf(anyCard);
                    
                    gameState.tableCards.push({ attack: anyCard, defend: null });
                    gameState.opponentHand.splice(cardIndex, 1);
                    gameState.currentPlayer = 'player';
                    
                    updateGameDisplay();
                    updateStatus('–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –∞—Ç–∞–∫—É–µ—Ç –∫–∞—Ä—Ç–æ–π ' + anyCard.value + anyCard.suit);
                }
            } else {
                // –ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –∑–∞—â–∏—â–∞–µ—Ç—Å—è
                const undefendedPair = gameState.tableCards.find(pair => !pair.defend);
                if (undefendedPair) {
                    const possibleCards = gameState.opponentHand.filter(card => canDefend(card, undefendedPair.attack));
                    
                    if (possibleCards.length > 0) {
                        const card = possibleCards[0];
                        const cardIndex = gameState.opponentHand.indexOf(card);
                        
                        undefendedPair.defend = card;
                        gameState.opponentHand.splice(cardIndex, 1);
                        
                        updateGameDisplay();
                        updateStatus('–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –æ—Ç–±–∏–ª—Å—è –∫–∞—Ä—Ç–æ–π ' + card.value + card.suit);
                        
                        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤—Å–µ –ª–∏ –∫–∞—Ä—Ç—ã –æ—Ç–±–∏—Ç—ã
                        if (gameState.tableCards.every(pair => pair.defend)) {
                            // –í—Å–µ –æ—Ç–±–∏—Ç—ã - —Ö–æ–¥ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ –∞—Ç–∞–∫—É—é—â–µ–º—É (–∏–≥—Ä–æ–∫—É) –¥–ª—è –ø–æ–¥–∫–∏–¥—ã–≤–∞–Ω–∏—è
                            gameState.currentPlayer = 'player';
                            updateActionButtons(); // –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ë–∏—Ç–æ" –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                            return;
                        }
                    } else {
                        // –ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –Ω–µ –º–æ–∂–µ—Ç –∑–∞—â–∏—Ç–∏—Ç—å—Å—è - –±–µ—Ä–µ—Ç –∫–∞—Ä—Ç—ã
                        opponentTakeCards();
                        return;
                    }
                }
            }
            
            updateActionButtons();
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
        function updateActionButtons() {
            const takeBtn = document.getElementById('takeBtn');
            const passBtn = document.getElementById('passBtn');
            
            takeBtn.style.display = 'none';
            passBtn.style.display = 'none';
            
            if (gameState.currentPlayer === 'player') {
                if (gameState.attacker !== 'player' && gameState.tableCards.some(pair => !pair.defend)) {
                    // –ò–≥—Ä–æ–∫ –∑–∞—â–∏—â–∞–µ—Ç—Å—è –∏ –µ—Å—Ç—å –Ω–µ–æ—Ç–±–∏—Ç—ã–µ –∫–∞—Ä—Ç—ã
                    takeBtn.style.display = 'inline-block';
                } else if (gameState.attacker === 'player' && gameState.tableCards.length > 0 && gameState.tableCards.every(pair => pair.defend)) {
                    // –ò–≥—Ä–æ–∫ –∞—Ç–∞–∫–æ–≤–∞–ª –∏ –≤—Å–µ –∫–∞—Ä—Ç—ã –æ—Ç–±–∏—Ç—ã
                    passBtn.style.display = 'inline-block';
                }
            }
        }

        // –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–æ–∑—ã–≥—Ä—ã—à (–∫–æ–≥–¥–∞ –≤—Å–µ –∫–∞—Ä—Ç—ã –æ—Ç–±–∏—Ç—ã)
        function completeRound() {
            gameState.tableCards = [];
            // –í –Ω–æ–≤–æ–º —Ä–æ–∑—ã–≥—Ä—ã—à–µ –∞—Ç–∞–∫—É–µ—Ç —Ç–æ—Ç, –∫—Ç–æ –∑–∞—â–∏—â–∞–ª—Å—è
            gameState.attacker = gameState.attacker === 'player' ? 'opponent' : 'player';
            gameState.currentPlayer = gameState.attacker;
            
            updateStatus('–†–æ–∑—ã–≥—Ä—ã—à –∑–∞–≤–µ—Ä—à–µ–Ω - –≤—Å–µ –∫–∞—Ä—Ç—ã –æ—Ç–±–∏—Ç—ã');
            
            // –î–æ–±–æ—Ä –∫–∞—Ä—Ç –¥–æ 6 (—Å–Ω–∞—á–∞–ª–∞ –∞—Ç–∞–∫—É—é—â–∏–π, –ø–æ—Ç–æ–º –∑–∞—â–∏—â–∞—é—â–∏–π—Å—è)
            drawCards();
            updateGameDisplay();
            
            if (gameState.currentPlayer === 'opponent') {
                setTimeout(opponentMove, 1000);
            }
        }

        // –í–∑—è—Ç—å –∫–∞—Ä—Ç—ã (–∏–≥—Ä–æ–∫)
        function takeCards() {
            gameState.tableCards.forEach(pair => {
                gameState.playerHand.push(pair.attack);
                if (pair.defend) {
                    gameState.playerHand.push(pair.defend);
                }
            });
            
            gameState.tableCards = [];
            // –ö—Ç–æ –±–µ—Ä–µ—Ç –∫–∞—Ä—Ç—ã - —Ç–æ—Ç –∑–∞—â–∏—â–∞–µ—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ä–æ–∑—ã–≥—Ä—ã—à–µ
            gameState.attacker = 'opponent';
            gameState.currentPlayer = 'opponent';
            
            updateStatus('–í—ã –≤–∑—è–ª–∏ –∫–∞—Ä—Ç—ã —Å–æ —Å—Ç–æ–ª–∞');
            
            // –î–æ–±–æ—Ä –∫–∞—Ä—Ç
            drawCards();
            updateGameDisplay();
            
            setTimeout(opponentMove, 1000);
        }

        // –í–∑—è—Ç—å –∫–∞—Ä—Ç—ã (–ø—Ä–æ—Ç–∏–≤–Ω–∏–∫)
        function opponentTakeCards() {
            gameState.tableCards.forEach(pair => {
                gameState.opponentHand.push(pair.attack);
                if (pair.defend) {
                    gameState.opponentHand.push(pair.defend);
                }
            });
            
            gameState.tableCards = [];
            // –ö—Ç–æ –±–µ—Ä–µ—Ç –∫–∞—Ä—Ç—ã - —Ç–æ—Ç –∑–∞—â–∏—â–∞–µ—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ä–æ–∑—ã–≥—Ä—ã—à–µ
            gameState.attacker = 'player';
            gameState.currentPlayer = 'player';
            
            updateStatus('–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –≤–∑—è–ª –∫–∞—Ä—Ç—ã —Å–æ —Å—Ç–æ–ª–∞');
            
            // –î–æ–±–æ—Ä –∫–∞—Ä—Ç
            drawCards();
            updateGameDisplay();
        }

        // –ü–∞—Å (–±–∏—Ç–æ) - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –∏–≥—Ä–æ–∫ –º–æ–∂–µ—Ç –ø–æ–¥–∫–∏–¥—ã–≤–∞—Ç—å, –Ω–æ –Ω–µ —Ö–æ—á–µ—Ç
        function passTurn() {
            if (gameState.tableCards.every(pair => pair.defend)) {
                completeRound();
            }
        }

        // –î–æ–±–æ—Ä –∫–∞—Ä—Ç
        function drawCards() {
            // –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∏—Ä–∞–µ—Ç –∞—Ç–∞–∫—É—é—â–∏–π, –ø–æ—Ç–æ–º –∑–∞—â–∏—â–∞—é—â–∏–π—Å—è
            const attacker = gameState.attacker === 'player' ? 'playerHand' : 'opponentHand';
            const defender = gameState.attacker === 'player' ? 'opponentHand' : 'playerHand';
            
            // –î–æ–±–æ—Ä –¥–æ 6 –∫–∞—Ä—Ç
            while (gameState[attacker].length < 6 && gameState.deck.length > 0) {
                gameState[attacker].push(gameState.deck.pop());
            }
            
            while (gameState[defender].length < 6 && gameState.deck.length > 0) {
                gameState[defender].push(gameState.deck.pop());
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ª–æ–≤–∏—è –ø–æ–±–µ–¥—ã
            checkWinCondition();
        }

        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ª–æ–≤–∏—è –ø–æ–±–µ–¥—ã
        function checkWinCondition() {
            if (gameState.deck.length === 0) {
                if (gameState.playerHand.length === 0) {
                    endGame('–í—ã –ø–æ–±–µ–¥–∏–ª–∏! üéâ');
                } else if (gameState.opponentHand.length === 0) {
                    endGame('–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏! üò¢');
                }
            }
        }

        // –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É
        function endGame(message = '–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞') {
            updateStatus(message);
            document.getElementById('gameMenu').style.display = 'block';
            document.getElementById('gameArea').style.display = 'none';
            
            // –°–±—Ä–æ—Å–∏—Ç—å –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            tg.MainButton.text = "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É";
            tg.MainButton.onClick = function() {
                tg.showAlert("–ò–≥—Ä–∞ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–∞! üéÆ");
            };
            
            tg.showAlert(message);
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ç–µ–º—É Telegram
        function adaptTheme() {
            const root = document.documentElement;
            if (tg.themeParams) {
                root.style.setProperty('--tg-theme-bg-color', tg.themeParams.bg_color);
                root.style.setProperty('--tg-theme-text-color', tg.themeParams.text_color);
                root.style.setProperty('--tg-theme-button-color', tg.themeParams.button_color);
            }
        }

        adaptTheme();
    </script>
</body>
</html>
